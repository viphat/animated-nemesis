app.controller "DashboardController", [ '$scope', ($scope) ->
  $scope.sorted_order = 'question,filters,base,wtd_resp,resp,header_and_data,totals,std_deviation,means,mode,medians'
  $scope.items = [
    {name: 'Question', value: 'question', is_dismissable: false}
    {name: 'Filters', value: 'filters', is_dismissable: false}
    {name: 'Base', value: 'base', is_dismissable: true}
    {name: 'WTD RESP', value: 'wtd_resp', is_dismissable: true}
    {name: 'RESP', value: 'resp', is_dismissable: true}
    {name: 'Header & Data', value: 'header_and_data', is_dismissable: false}
    {name: 'Totals', value: 'totals', is_dismissable: true}
    {name: 'Std.Deviation', value: 'std_deviation', is_dismissable: true}
    {name: 'Means', value: 'means', is_dismissable: false}
    {name: 'Mode', value: 'mode', is_dismissable: true}
    {name: 'Medians', value: 'medians', is_dismissable: true}
  ]
  $scope.backup = angular.copy($scope.items)
  $scope.reset = () ->
    $scope.items = angular.copy($scope.backup)

  $scope.dismiss = (item) ->
    if item.value == 'wtd_resp'
      i =  _.find($scope.items, (o) ->
        o.value == 'resp'
      )
      unless i?
        sweetAlert
          title: 'Lỗi'
          text: 'Bắt buộc phải có 1 trong 2 dòng RESP hoặc WTD RESP'
          type: 'warning'
          showCancelButton: false
          closeOnConfirm: false
          html: true
          timer: 3000
        return


    if item.value == 'resp'
      i =  _.find($scope.items, (o) ->
        o.value == 'wtd_resp'
      )
      unless i?
        sweetAlert
          title: 'Lỗi'
          text: 'Bắt buộc phải có 1 trong 2 dòng RESP hoặc WTD RESP'
          type: 'warning'
          showCancelButton: false
          closeOnConfirm: false
          html: true
          timer: 3000
        return
    _.remove($scope.items, (n) ->
      n == item
    )
    sorted_order = []
    _.map($scope.items, (n)->
      sorted_order.push(n.value)
    )

    $scope.sorted_order = sorted_order.join(',')

  $scope.sortableOptions =
    update: (e,ui) ->
      return
    stop: (e,ui) ->
      sorted_order = []
      _.map($scope.items, (n)->
        sorted_order.push(n.value)
      )
      $scope.sorted_order = sorted_order.join(',')
      return
]
